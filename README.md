# Calculator

## Описание проекта

Это микросервис калькулятора, который предоставляет HTTP и gRPC API для выполнения арифметических операций (сложение, вычитание, умножение).

## Алгоритм работы

1. **Построение дерева зависимостей**:
    - При получении списка инструкций сервис строит дерево зависимостей между переменными
    - Каждая переменная представляется как узел (`Node`) в графе
    - Литералы (числа) становятся терминальными узлами
    - Операции связывают узлы через левый и правый операнды

2. **Параллельное вычисление**:
    - Для каждого узла создается канал `Ready`, который закрывается при завершении вычисления
    - Узлы вычисляются параллельно, но с учетом зависимостей (узел ждет вычисления своих операндов)
    - Используется стратегия (`EvaluationStrategy`) для выполнения арифметических операций

3. **Сбор результатов**:
    - После вычисления всех узлов собираются результаты для переменных, помеченных для вывода
    - Используется стратегия (`PrintingStrategy`) для формирования результатов

4. **Очистка состояния**:
    - Перед обработкой нового набора инструкций состояние сервиса сбрасывается

## Запуск сервиса

```bash
go run cmd/server/main.go
```

или через Docker

```bash
docker compose up
```

Сервис запустит:
- HTTP сервер на порту 8080
- gRPC сервер на порту 50051

## API Endpoints

### HTTP API

- `POST /calculate` - выполнение вычислений
- `GET /health` - проверка доступности сервера
- `GET /swagger/` - документация Swagger UI

Пример запроса:
```json
POST /calculate
{
  "instructions": [
    {
      "type": "calc",
      "var": "x",
      "op": "+",
      "left": 5,
      "right": 3
    },
    {
      "type": "print",
      "var": "x"
    }
  ]
}
```

Пример ответа:
```json
{
  "items": [
    {
      "var": "x",
      "value": 8
    }
  ]
}
```